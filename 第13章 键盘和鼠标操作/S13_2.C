#include <dos.h>
#include <stdio.h>
#include <graphics.h>
int init();
int read_mouse();
void cursor(),newxy();
int main()
{
 int buttons,x,y;
 char str[100];
 int driver=VGA;
 int mode=VGAHI;
 initgraph(&driver,&mode,"");
 cleardevice();
 rectangle(0,0,639,479);
 setfillstyle(SOLID_FILL,BLUE);
 bar(1,1,638,478);
 outtextxy(3,15,"move mouse using any button.");
 outtextxy(285,15,"quit");
 setwritemode(XOR_PUT);
 if(init(2, 638, 8, 477)==0 )     /*调用init 函数对鼠标器初始化*/
   {printf("Mouse or Mouse Driver Absent,P1ease install!");
    delay(5000);
    closegraph();
    exit(1);
   }
 x=320;y=240;
 cursor(x,y);                       /*置十字光标在屏幕中心*/
 for(;;)
   {
    newxy(&x,&y,&buttons);
    if(x>=280&& x<=330 &&y>=12&&y<=33&& buttons)
      {
       cleardevice();
       closegraph();
       exit(0);
      }
   }
}
void cursor(int x,int y)            /* 画十字光标函数 */
{
 int x1,x2,y1,y2;
 x1=x-4;
 x2=x+4;
 y1=y-3;
 y2=y+3;
 line(x1,y,x2,y);
 line(x,y1,x,y2);
}
int init(int xmin,int xmax,int ymin,int ymax)  /*初始化函数 */
{union REGS regs;
 regs.x.ax=0;
 int86(51,&regs,&regs);
 if(regs.x.ax == 0)
   return 0;         /* 返回0 表示鼠标或鼠标驱动程序未安装 */
 regs.x.ax=7;
 regs.x.cx=xmin;
 regs.x.dx=xmax;
 int86(51,&regs,&regs);
 regs.x.ax=8;
 regs.x.cx=ymin;
 regs.x.dx=ymax;
 int86(51,&regs,&regs);   
 return -1;         /* 表示鼠标器和驱动程序已安装 */
}
int read_mouse(int *mx,int *my,int *mbutton)
{union REGS regs;
 int x0=*mx, y0=*my, button0=*mbutton;
 int xnew, ynew;
 do
   {regs.x.ax=3;
    int86(0x33,&regs,&regs);
    xnew=regs.x.cx;
    ynew=regs.x.dx;
    *mbutton=regs.x.bx;
   }while(xnew == x0 && ynew == y0 && *mbutton == button0);
 *mx=xnew;
 *my=ynew;
 switch(*mbutton)
   {
    case 0:   return 0;
    case 1:   return 1;
    case 2:   return 2;
    case 3:   return 3;
    default:  return 4;
   }
}

void newxy(int *mx,int *my,int *mbutt)
{
 int ch,xx0=*mx,yy0=*my;
 int xm,ym;
 ch=read_mouse(&xm,&ym,mbutt);
 cursor(xx0,yy0);
 cursor(xm,ym);
 switch(ch)
   {
    case 0:
	   break;
    case 1:
	   circle(xm,ym,6);
	   break;
    case 2:
	   rectangle(xm,ym,xm+12,ym+12);
	   break;
    default:
	   putpixel(xm,ym,7);
	   break;
   }
 *mx=xm;
 *my=ym;
}


